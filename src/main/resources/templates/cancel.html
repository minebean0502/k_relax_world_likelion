<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>대형 페기물 키오스크</title>

    <script
            src="https://code.jquery.com/jquery-3.3.1.min.js"
            integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
            crossorigin="anonymous"></script>
    <script>
        function checkPay() {

            jQuery.ajax({

                url: "/cancel/check",
                type: "POST",
                dataType: "json",
                success: function (response) {
                    var optionsData = [];
                    for (var i = 0; i < response.length; i++) {
                        optionsData.push(response[i].payment_uid);                    }
                    var selectElement = document.getElementById("mySelect");

                    selectElement.innerHTML = "";

                    optionsData.forEach(function(optionValue) {
                        var option = document.createElement("option");
                        option.text = optionValue;
                        selectElement.add(option);
                        alert("성공");
                    });
                },
                error: function (xhr, status, error) {
                    // 에러 처리
                    alert("실패");
                    console.error(error);
                }
            });
        }
        function cancelPay() {
            // 선택된 paymentUid 가져오기
            var selectElement = document.getElementById("mySelect");
            var selectedPaymentUid = selectElement.value;

            jQuery.ajax({
                url: "/cancel/"+selectedPaymentUid,
                type: "POST",
                headers: {"Content-Type": "application/json"},
                "data": JSON.stringify({

                    payment_uid:selectedPaymentUid , // 예: ORD20180131-0000011
                    "reason": "테스트 결제 환불", // 환불사유
                    // [가상계좌 환불시 필수입력] 환불 수령계좌 예금주
                    "refund_holder": "홍길동",
                    // [가상계좌 환불시 필수입력] 환불 수령계좌 은행코드(예: KG이니시스의 경우 신한은행은 88번)
                    "refund_bank": "88",
                    // [가상계좌 환불시 필수입력] 환불 수령계좌 번호
                    "refund_account": "56211105948400"
                }),

                dataType: "json",
                success: function (response) {
                    alert("환불 성공");
                    // 성공 처리
                },
                error: function (xhr, status, error) {
                    // 에러 처리
                    alert("결제 내역이 없습니다")
                    console.error(error);
                }
            });
        }
    </script>
    <style>

        .empty-space {
            margin: 20px;
        }
    </style>
</head>
<body>
<label for="mySelect"></label>
<select id="mySelect"></select>
<button onclick="checkPay()">결제번호 가져오기</button>
<button onclick="cancelPay()">환불하기</button>
<div class="empty-space">
    <a href="/">홈으로 이동</a>
</div>

</body>
</html>
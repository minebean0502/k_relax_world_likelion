<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<!--    <link rel="stylesheet" href="/css/Home.css">-->
    <link rel="stylesheet" href="/css/MainUse.css">
    <title>키오스크 홈 화면</title>

</head>
<link rel="icon" href="data:;base64,iVBORw0KGgo=">

<body>
<div class="service-container">
    <header>
        <h1>키오스크 홈 화면입니다</h1>
        <div class="time">Wed 03rd March 2:19 PM</div>
    </header>

    <section class="service-selection">
        <div class="service-option" id="service-1">
            <img src="/images/apartment.jpg" alt="Service 1"><br><br>
            <button type="button" onclick="location.href='/login'">로그인</button>
            <button type="button" onclick="location.href='/register'">회원가입</button>
            <button type="button" id="goToServices">서비스 버튼</button>
            <!--  로그아웃 버튼  -->
            <button type="button" class="logout-button" id="logoutButton">로그아웃</button>
        </div>
        <!-- 다른 서비스 옵션들을 추가합니다 -->
        <!-- 예를 들어, id="service-2", id="service-3" ... -->
    </section>
</div>
<!-- jQuery 라이브러리 추가 -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<!-- 로그아웃 스크립트 추가 -->
<script src="/temp/logout.js"></script>
<script>
    document.getElementById('goToServices').addEventListener('click', function(e) {
        e.preventDefault();
        const jwtToken = localStorage.getItem('jwtToken');
        if (jwtToken) {
            // 사용자가 로그인되어 있음을 확인했다면, /services 페이지로 직접 이동합니다.
            // 이동하기 전에 서버에 인증 요청을 보내는 AJAX 요청은 필요하지 않습니다.
            // 대신, 서버는 /services 요청을 받을 때 사용자의 인증 상태를 검증해야 합니다.
            window.location.href = '/services';
        } else {
            alert('로그인이 필요합니다.');
            window.location.href = '/login';
        }
    });
</script>
<script>
    $(document).ready(function() {
        // 서비스 페이지로 이동하려는 버튼 또는 링크에 대한 클릭 이벤트 핸들러
        $("#goToServices").on("click", function(e) {
            e.preventDefault(); // 기본 이벤트를 방지합니다.

            const jwtToken = localStorage.getItem('jwtToken'); // 로컬 스토리지에서 JWT 토큰 가져오기

            if (jwtToken) {
                // AJAX 요청을 사용하여 서버에 인증 정보를 포함하여 /services 경로로 요청을 보냅니다.
                $.ajax({
                    url: '/services', // 요청을 보낼 경로
                    type: 'GET', // HTTP 요청 메서드
                    contentType: "application/json", // 서버가 JSON 형태의 데이터를 받기를 기대
                    beforeSend: function(xhr) {
                        xhr.setRequestHeader("Authorization", "Bearer " + jwtToken);
                    },
                    success: function(response) {
                        // 요청이 성공하면, 서버로부터 받은 응답(예: HTML 페이지 또는 데이터)을 처리합니다.
                        // 예: document.location.href = '/services'; 페이지 이동
                        // 또는 페이지 내용을 동적으로 업데이트할 수 있습니다.
                        console.log(response);
                        console.log(jwtToken);
                        // 요청이 성공하면, /services 페이지로 리다이렉트합니다.
                        window.location.href = '/services';
                    },
                    error: function(xhr, status, error) {
                        // 인증 실패 또는 기타 오류 처리
                        console.error("Error: " + error);
                        // 필요에 따라 사용자를 로그인 페이지로 리다이렉트할 수 있습니다.
                    }
                });
            } else {
                // JWT 토큰이 없는 경우, 예를 들어 로그인 페이지로 이동시킬 수 있습니다.
                console.log("JWT 토큰이 없습니다.");
            }
        });
    });
</script>
</body>
</html>
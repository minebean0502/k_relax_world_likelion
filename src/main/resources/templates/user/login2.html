<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>로그인 화면</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="/css/MainUse.css">
</head>
<link rel="icon" href="data:;base64,iVBORw0KGgo=">

<body>
<div class="login-container">
    <header>
        <h1>대행 폐기물 키오스크</h1>
        <div class="time">Wed 03rd March 2:19 PM</div>
    </header>

    <section class="login-form">
        <form id="loginForm">
            <div class="input-group">
                <label for="userId">계정 ID: </label>
                <input type="text" id="userId" name="userId" required placeholder="아이디">
            </div>
            <div class="input-group">
                <label for="password">비밀번호: </label>
                <input type="password" id="password" name="password" required placeholder="비밀번호">
            </div>
            <div class="keypad">
                <!-- 여기에 숫자 키패드 버튼을 추가합니다 -->
            </div>
            <div>

                <button type="button" onclick="location.href='/home'">돌아가기</button>
                <!--   제출 버튼     -->
                <button type="submit">Submit</button>
                <!-- id, pw 이동 버튼 -->
                <button type="button" onclick="location.href='/idpw/id/find'">아이디 찾기</button>
                <button type="button" onclick="location.href='/idpw/pw/find'">비밀번호 찾기</button>
            </div>
            <h3>이 로그인 페이지는 현재 작동중인 페이지 입니다.</h3>
        </form>
    </section>
</div>
<footer>
    <!-- 푸터 내용을 추가합니다 -->
</footer>
<script>
    $(document).ready(function () {
        $('#loginForm').submit(function (event) {
            event.preventDefault(); // 폼 기본 동작 제출 방지

            const userId = $('#userId').val();
            const password = $('#password').val();
            const data = {userId, password};

            $.ajax({
                type: "POST",
                url: "/v1/user/login",
                contentType: "application/json",
                data: JSON.stringify(data),
                success: function (response) {
                    const token = response.token;
                    console.log("로그인 성공", token);

                    if (token) {
                        localStorage.setItem("jwtToken", token);
                        window.location.href = "/services";
                    } else {
                        console.log("토큰이 반환되지 않았습니다.")
                    }
                },
                error: function (xhr, status, error) {
                    console.log("로그인 실패", xhr.responseText);
                    alert("아이디나 비밀번호가 일치하지 않습니다.")
                }
            });
        });
    });
</script>
</body>
</html>
